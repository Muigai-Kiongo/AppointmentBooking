{% extends 'index.html' %}
{% load static %}

{% block content %}
<main class="appointment-detail-page" role="main" aria-labelledby="appointment-title">
  <nav class="breadcrumb" aria-label="Breadcrumb">
    <a href="{% url 'booking:appointment_list' %}">Appointments</a>
    <span aria-hidden="true">/</span>
    <span>{{ booking.appointment_date|date:"M j, Y" }} â€¢ {{ booking.appointment_time|time:"g:i A" }}</span>
  </nav>

  <section class="detail-card" aria-labelledby="appointment-title">
    <header class="detail-header">
      <h1 id="appointment-title">Appointment details</h1>
      <div class="meta">
        <span class="meta-item">Reference: <strong>#{{ booking.pk }}</strong></span>
        {% if booking.is_paid %}
          <span class="pill pill-paid">Paid</span>
        {% else %}
          <span class="pill pill-pending">Payment pending</span>
        {% endif %}
      </div>
    </header>

    <div class="detail-grid">
      <div class="left">
        <dl class="details">
          <div class="detail-row">
            <dt>Date</dt>
            <dd>{{ booking.appointment_date|date:"F j, Y" }}</dd>
          </div>
          <div class="detail-row">
            <dt>Time</dt>
            <dd>{{ booking.appointment_time|time:"g:i A" }}</dd>
          </div>
          <div class="detail-row">
            <dt>Doctor</dt>
            <dd>Dr. {{ booking.doctor.user.get_full_name|default:booking.doctor.user.username }}</dd>
          </div>
          <div class="detail-row">
            <dt>Type</dt>
            <dd>{{ booking.appointment_type }}</dd>
          </div>
          {% if booking.location %}
          <div class="detail-row">
            <dt>Location</dt>
            <dd>{{ booking.location }}</dd>
          </div>
          {% endif %}
          {% if booking.notes %}
          <div class="detail-row">
            <dt>Patient notes</dt>
            <dd class="notes">{{ booking.notes }}</dd>
          </div>
          {% endif %}
        </dl>
      </div>

      <aside class="right">
        <div class="actions" role="region" aria-label="Appointment actions">
          <a class="action btn-primary" href="{% url 'booking:payment' %}?appointment_id={{ booking.pk }}" {% if booking.is_paid %}aria-disabled="true"{% endif %}>
            <svg class="icon" width="16" height="16" viewBox="0 0 16 16" aria-hidden="true"><path d="M3 3h10v2H3zM3 6h10v7a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V6z"/></svg>
            {% if booking.is_paid %}View payment{% else %}Pay booking{% endif %}
          </a>

          <a class="action btn-ghost" href="{% url 'booking:appointment_update' booking.pk %}">
            <svg class="icon" width="16" height="16" viewBox="0 0 16 16" aria-hidden="true"><path d="M12.146.146l3 3L6 12.293V9H2v-4h3.293L12.146.146z"/></svg>
            Reschedule
          </a>

          {# Link to delete-confirm page (GET). Actual deletion occurs only after POST on that page. #}
          <a class="action btn-danger" href="{% url 'booking:appointment_delete' booking.pk %}">
            <svg class="icon" width="16" height="16" viewBox="0 0 16 16" aria-hidden="true"><path d="M5.5 5.5v6M8 5.5v6M10.5 5.5v6M6 1h4l1 1H5l1-1z"/></svg>
            Cancel appointment
          </a>

          <a class="action btn-outline" href="{% url 'booking:appointment_list' %}">Back to list</a>
        </div>

        <div class="help">
          <p class="small">If you need to change the appointment details, use Reschedule. For urgent cancellations contact reception.</p>
        </div>
      </aside>
    </div>
  </section>
</main>

<style>
/* Page layout */
.appointment-detail-page { max-width: 1100px; margin: 20px auto; padding: 0 16px; }
.breadcrumb { display:flex; gap:8px; align-items:center; color:#6b7280; font-size:14px; margin-bottom:12px; }
.breadcrumb a { color:#2563eb; text-decoration:none; }
.detail-card { background:#fff; border:1px solid #eef2f7; border-radius:12px; padding:20px; box-shadow:0 8px 24px rgba(35,49,66,0.04); }
.detail-header { display:flex; justify-content:space-between; align-items:flex-start; gap:12px; margin-bottom:12px; }
.detail-header h1 { margin:0; font-size:20px; color:#0f172a; }
.meta { display:flex; gap:10px; align-items:center; font-size:14px; color:#6b7280; }
.pill { padding:6px 10px; border-radius:999px; font-weight:700; font-size:12px; }
.pill-paid { background:#ecfdf5; color:#065f46; border:1px solid #bbf7d0; }
.pill-pending { background:#fffbeb; color:#92400e; border:1px solid #fde68a; }

/* Grid */
.detail-grid { display:grid; grid-template-columns: 1fr 320px; gap:20px; align-items:start; }
.details { margin:0; }
.detail-row { display:flex; gap:10px; padding:8px 0; border-bottom:1px dashed #f1f5f9; }
.detail-row dt { width:110px; font-weight:700; color:#374151; }
.detail-row dd { margin:0; color:#0f172a; }
.notes { white-space:pre-wrap; color:#334155; }

/* Actions */
.right .actions { display:flex; flex-direction:column; gap:10px; margin-bottom:12px; }
.action { display:inline-flex; align-items:center; gap:8px; padding:10px 12px; border-radius:8px; text-decoration:none; font-weight:700; font-size:14px; }
.btn-primary { background:#2563eb; color:#fff; }
.btn-primary[aria-disabled="true"] { opacity:0.6; pointer-events:none; }
.btn-ghost { background:transparent; color:#0f172a; border:1px solid #e6eef8; }
.btn-danger { background:#ef4444; color:#fff; }
.btn-outline { background:#f8fafc; color:#0f172a; border:1px solid #e6eef8; }
.action .icon { width:16px; height:16px; display:inline-block; }

/* Help text */
.help .small { font-size:13px; color:#6b7280; margin:0; }

/* Responsive */
@media (max-width: 860px) {
  .detail-grid { grid-template-columns: 1fr; }
  .right { order:2; }
  .left { order:1; }
  .detail-row dt { width: 100px; }
}
</style>
{% endblock %}